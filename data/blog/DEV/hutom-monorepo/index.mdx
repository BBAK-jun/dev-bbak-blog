---
title: íœ´í†° í”„ë¡ íŠ¸ì—”ë“œ íŒŒíŠ¸ MonoRepo  ë„ì…
date: '2024-05-23T10:44:03.284Z'
tags: ['DEV']
draft: true
summary: í©ì–´ì ¸ìˆëŠ” í”„ë¡ íŠ¸ì—”ë“œ í•œê³³ìœ¼ë¡œ ë­‰ì¹˜ê¸°
---

# **ë„ì… ë°°ê²½**

ì•ˆë…•í•˜ì„¸ìš”. íœ´í†° í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ë°•ì¤€í˜•ì…ë‹ˆë‹¤.

íœ´í†°ì˜ í”„ë¡ íŠ¸ì—”ë“œ ì œí’ˆì€ ê°ìì˜ Repositoryë¥¼ ê°–ê³ ìˆëŠ” ë©€í‹°ë ˆí¬ ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬ë˜ê³ ìˆìŠµë‹ˆë‹¤. ê°ê°ì˜ ì œí’ˆì€ìš´ì˜ë°©ì‹ê³¼ ë¼ì´í”„ì‚¬ì´í´ì´ ëª¨ë‘ ë‹¤ë¥´ê²Œ ê´€ë¦¬ë˜ê³ ìˆìŠµë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/hutom-frontend-repository.png)

ë…ë¦½ì ì¸ ê´€ë¦¬í¬ì¸íŠ¸ë¥¼ ê°–ëŠ” ë©€í‹°ë ˆí¬ ë°©ì‹ì€ í”„ë¡œì íŠ¸ì˜ ì™„ì „í•œ ë…ë¦½ì„±ì„ ë³´ì¥í•œë‹¤ëŠ” ì¥ì ì„ ê°–ê³ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê°ê°ì˜ ê´€ë¦¬í¬ì¸íŠ¸ë¥¼ ê°–ê³ ìˆê¸° ë•Œë¬¸ì— ê°œë°œìë“¤ì˜ ë¶ˆí¸í•¨ë„ í•¨ê»˜ ë‹¤ê°€ì˜¤ê³ ìˆë‹¤ê³  ìš°ë ¤ë˜ì—ˆìŠµë‹ˆë‹¤.

ë¬¼ë¡  ê¸´ë°€í•œ ì˜ì‚¬ì†Œí†µê³¼ ë¯¸íŒ…ê³¼ ê°™ì€ ì¶”ìƒì ì¸ ê³µìœ ë¥¼ í†µí•´ ê´€ë¦¬í¬ì¸íŠ¸ì˜ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ë„ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë¬¼ë¦¬ì ìœ¼ë¡œ ê³µìœ ë„ í•˜ë©° ì¶”ìƒì ì¸ ê³µìœ ë„ í•¨ê»˜í•œë‹¤ë©´ ì˜ì‚¬ì†Œí†µì˜ ë¹„ìš©ë„ ì ˆê°ë˜ì§€ì•Šì„ê¹Œë¼ëŠ” ìƒê°ì„ í•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.

ì˜ˆë¥¼ í•œë²ˆ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

`hVAT`ì™€ `hServer` ëŠ” ì´ë¯¸ ì¶œì‹œê°€ ë˜ì–´ìˆëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ì‹ ê·œ ì„œë¹„ìŠ¤ì¸ `SurgGram` ë¥¼ ë§Œë“¤ì–´ì•¼í•˜ëŠ” ìƒí™©ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë”©í•˜ëŠ” ê³¼ì •ì„ í•œë²ˆ ìƒê°í•´ë´…ë‹ˆë‹¤. ë§Œì•½ `SurgGram`ì˜ íŠ¹ì •ê¸°ëŠ¥ì´ `hVAT`ì—ì„œ ì‚¬ìš©í•˜ê³ ìˆëŠ” ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ì˜ ê¸°ëŠ¥ê³¼ ìœ ì‚¬í•˜ë‹¤ê³  íŒë‹¨ë˜ì–´ ì»´í¬ë„ŒíŠ¸ì™€ ì—¬ëŸ¬ í—¬í¼í•¨ìˆ˜ ëª¨ë“ˆì„ ê°œë°œìê°€ ì§ì ‘ ì½”ë“œë¥¼ ë³µì‚¬í•˜ê³  ë¶™ì—¬ë„£ê¸°ë¥¼ í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ëŸ° ê²½ìš° ì§ì ‘ì ì¸ ê³µìœ ê°€ ì•„ë‹Œ ê°„ì ‘ì ì¸ ê³µìœ ì…ë‹ˆë‹¤.

ì œí’ˆë§ˆë‹¤ ë°°í¬ì „ëµê³¼ ë¸Œëœì¹˜ ì „ëµì„ í”½ìŠ¤í•˜ë©° ë¬¸ì„œë¡œ ë§ˆë ¨í•˜ê³ , ì´ëŸ¬í•œ ë¸Œëœì¹˜ ì „ëµ ê¹Œì§€ í•˜ë‚˜ì˜ ì½”ë“œë² ì´ìŠ¤ì—ì„œ ê´€ë¦¬ë¥¼ í•œë‹¤ë©´, ì „ëµì´ í‘œì¤€í™”ë˜ê³  ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ê¹Œì§€ ë§ˆë ¨ë˜ì–´ ì •ì‹ ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ë˜í•œ ì‚¬ë¼ì§€ì§€ ì•Šì„ê¹Œí•˜ì—¬ ëª¨ë…¸ë ˆí¬ë¥¼ ë„ì…í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

## ëª¨ë…¸ë ˆí¬ë¥¼ ë„ì…í•˜ì—¬ ì–»ê²Œë˜ëŠ” ì´ì 

- ë¹„ìŠ·í•œ ì œí’ˆêµ°ì„ í•˜ë‚˜ì˜ ì €ì¥ì†Œì—ì„œ ê´€ë¦¬
  - ê³µí†µ ëª¨ë“ˆ, í—¬í¼, ìœ í‹¸ í•¨ìˆ˜ë¥¼ í•¨ê»˜ ì‚¬ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
  - ì„œë¡œ ì˜ì¡´ì ì¸ íŒ¨í‚¤ì§€ì˜ ë¦¬íŒ©í† ë§ ë¹„ìš©ê°ì†Œ
- ì‹ ê·œ ì œí’ˆ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í• ë•Œë§ˆë‹¤ ë°œìƒí•˜ëŠ” ì˜¤ë²„í—¤ë“œ ì ˆê°
  - ë ˆí¬ì§€í† ë¦¬ ìƒì„± â†’ ì»¤ë¯¸í„° ìƒì„± â†’ ê°œë°œí™˜ê²½ ì„¸íŒ… â†’ CI/CD êµ¬ì¶• â†’ ë¹Œë“œ â†’ publish ê³¼ì •ìƒëµ
- ê´€ë¦¬í¬ì¸íŠ¸ê°€ ë‹¨ì¼í™”
- ì½”ë“œìŠ¤íƒ€ì¼ í†µì¼í™”
  - ì»¤ë¯¸í„° ìƒì„±ì—ì„œ ë¦°íŠ¸ ë° í”„ë¦¬í‹°ì–´ ì„¤ì •ì„ í•˜ëŠ”ë° ë ˆí¬ì§€í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ë£°ì„ ì •í•˜ë‹ˆ ìŠ¤íƒ€ì¼ í†µì¼í™” ê¸°ëŒ€í• ìˆ˜ìˆë‹¤.
  - í•œì¡°ì§ì´ ê°œë°œí–ˆì§€ë§Œ í•œ ì‚¬ëŒì´ ê°œë°œí•œê²ƒê³¼ ê°™ì€ í€„ë¦¬í‹°ì˜ ì½”ë“œìŠ¤íƒ€ì¼ í†µì¼ì„±ì„ ê¸°ëŒ€í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ëª¨ë…¸ë ˆí¬ë¥¼ ë„ì…í•˜ì—¬ ìš°ë ¤ë˜ëŠ” ì 

- ê¸°ì¡´ì— ì‚¬ìš©ì¤‘ì¸ **GitFlow** ë¸Œëœì¹˜ ì „ëµ ì‚¬ìš© ë¶ˆê°€
  - ì„œë¹„ìŠ¤ë§ˆë‹¤ developë¸Œëœì¹˜ì™€ main ë¸Œëœì¹˜ë¥¼ ë§Œë“¤ê¸°ì—ëŠ” í˜„ì‹¤ì ìœ¼ë¡œ ì–´ë ¤ì›€
- í…ŒìŠ¤íŠ¸ ë° ë¹Œë“œ ë²”ìœ„
  - ì†ŒìŠ¤ ë³€ê²½ì‹œ ëª¨ë“  í”„ë¡œì íŠ¸ë¥¼ ë‹¤ì‹œ ë¹Œë“œí•˜ê±°ë‚˜ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ì§€ ì•Šìœ¼ë©° ì˜í–¥ì„ ë°›ëŠ” í”„ë¡œì íŠ¸ë§Œ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê³  ë¹Œë“œí•´ì•¼í•œë‹¤.

ë„ì…í•˜ë©° ì–»ê²Œë˜ëŠ” ì´ì ê³¼ ìš°ë ¤ì§€ì ì€ ë„êµ¬ë¥¼ ì„ íƒí•œë’¤ í•´ê²°í•˜ê¸°ë¡œí•˜ê³ , ìš°ì„  ì–´ë–¤ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì™€ ëª¨ë…¸ë ˆí¬ íˆ´ì„ ì‚¬ìš©í• ì§€ ê³ ë ¤ë¥¼ í•˜ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.

# íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ë¹„êµ

ëª¨ë…¸ë ˆí¬ë¥¼ ë„ì…í•˜ë©° íŒ¨í‚¤ì§€ë§¤ë‹ˆì €ë„ ë°”ê¾¸ì–´ë³´ìëŠ” ìƒê°ê³¼ í•¨ê»˜ ë¹„êµë¥¼ í•´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ì˜ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ íŒ¨í‚¤ì§€ë§¤ë‹ˆì €ë¡œ Yarn Classicì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. Yarn Classicì´ë€ Yarn 1.x ë²„ì „ì„ ì§€ì¹­í•©ë‹ˆë‹¤. ì„±ëŠ¥ë©´ì—ì„œ ë‹¤ì†Œ ëŠë¦´ ë¿ë§Œ ì•„ë‹ˆë¼ ì˜ì¡´ì„± ì¤‘ë³µì €ì¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸°ìœ„í•´ í˜¸ì´ìŠ¤íŒ… ë°©ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì–´ë–¤ ë¬¸ì œê°€ ì¡´ì¬í•˜ëŠ”ì§€ ì•Œì•„ì•¼í•©ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/pnpm.png)

- node_modulesì˜ ë¬¸ì œì 

  - node.jsì—ì„œ require í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ ëª¨ë“ˆì„ ì°¾ì„ë•Œê¹Œì§€ ìƒìœ„ ë””ë ‰í† ë¦¬ë¥¼ ìˆœíšŒí•˜ëŠ”ë° ì´ë•Œ ëŠë¦° Disk I/O ë™ì‘ì´ ê²½ë¡œì˜ ê¹Šì´ë§Œí¼ ë°œìƒí•˜ê²Œ ë©ë‹ˆë‹¤.

- ì €ì¥ê³µê°„ê³¼ ì„¤ì¹˜ì‹œê°„
  - node_modulesëŠ” ë§¤ìš° í° ê³µê°„ì„ ì°¨ì§€í•œë‹¤. ìš©ëŸ‰ë§Œ ë§ì´ì°¨ì§€í•œë‹¤ë©´ ë‹¤í–‰ì…ë‹ˆë‹¤. ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ë§Œë“¤ê¸°ìœ„í•´ì„œ ë§ì€ I/O ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.
  - ë³µì¡í•œ í´ë”êµ¬ì¡°ì´ê¸°ë•Œë¬¸ì— ì„¤ì¹˜ê°€ ìœ íš¨í•œì§€ ê²€ì¦í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. ìˆ˜ë°±ê°œì˜ íŒ¨í‚¤ì§€ê°€ ì„œë¡œë¥¼ ì˜ì¡´í•˜ëŠ” ë³µì¡í•œ ì˜ì¡´ì„± íŠ¸ë¦¬ì—ì„œ ë””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ê¹Šì–´ì§‘ë‹ˆë‹¤.
  - ë””ìŠ¤í¬ I/O í˜¸ì¶œì€ ë©”ëª¨ë¦¬ì˜ ìë£Œêµ¬ì¡°ë¥¼ ë‹¤ë£¨ëŠ”ê²ƒë³´ë‹¤ í›¨ì”¬ ëŠë¦½ë‹ˆë‹¤.
- ìœ ë ¹ì˜ì¡´ì„±
  - ì™¼ìª½ íŠ¸ë¦¬ì—ì„œ Aì™€ CíŒ¨í‚¤ì§€ëŠ” BíŒ¨í‚¤ì§€ë¥¼ ì˜ì¡´ì„±ì„ ë„ê²Œ ë˜ëŠ”ë° A ì™€ Cë¥¼ ì„¤ì¹˜í•˜ë©° Bë¥¼ ë‘ë²ˆ ì„¤ì¹˜í•˜ê²Œë˜ì–´ ë””ìŠ¤í¬ ê³µê°„ ë‚­ë¹„ë¥¼ í•˜ê²Œë©ë‹ˆë‹¤.
    - ì´ë•Œ package-1ì—ì„œëŠ” ì§ì ‘ require(â€™Bâ€™) ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/hoist.png)

- ì´ë¥¼ í•´ê²°í•˜ê¸°ìœ„í•´ ì˜¤ë¥¸ìª½íŠ¸ë¦¬ì²˜ëŸ¼ ì›ë˜ì˜ íŠ¸ë¦¬ì˜ ëª¨ì–‘ì„ ë°”ê¿‰ë‹ˆë‹¤.
  - ì´ë ‡ê²Œ ë˜ë©´ì„œ package-1ì—ì„œ ì§ì ‘ require(â€™Bâ€™)ê°€ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.
  - ì§ì ‘ì˜ì¡´í•˜ì§€ì•ŠëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ requireí• ìˆ˜ìˆëŠ” í˜„ìƒì„ ìœ ë ¹ ì˜ì¡´ì„±ì´ë¼ê³ í•©ë‹ˆë‹¤.
  - ì´ëŠ” package.json**ì—ì„œ ì œê±°í–ˆì„ë•Œ ì†Œë¦¬ì—†ì´ ì‚¬ë¼ì§€ë©° ì˜ì¡´ì„±ê´€ë¦¬ ì‹œìŠ¤í…œì„ í˜¼ë€ìŠ¤ëŸ½ê²Œ ë§Œë“­ë‹ˆë‹¤.**

ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ í¬ê²Œ ë‘ê°€ì§€ì…ë‹ˆë‹¤. Yarn Berryì™€ Pnpmì…ë‹ˆë‹¤. Yarn BerryëŠ” Plugâ€™n Play ì „ëµì„ í†µí•´ ì¤‘ë³µ ì €ì¥ ë¬¸ì œë¥¼ í•´ê²°í•˜ë©° í˜¸ì´ìŠ¤íŒ… ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ì•ŠëŠ”ê²ƒì´ ê¸°ë³¸ê°’ì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì €í¬ê°€ ì„ íƒí•œ íŒ¨í‚¤ì§€ë§¤ë‹ˆì €ëŠ” Pnpmì…ë‹ˆë‹¤.

ì„ íƒí•œ ì´ìœ ë¶€í„° ë§í•˜ë©´, ë’¤ì—ì„œ ì„ íƒí•˜ê²Œëœ **TurboRepo**ì—ì„œëŠ” í˜„ì¬ê¹Œì§€ Yarn Berryì˜ Plugâ€™n Playì„ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. Pnpmì´ë¼ëŠ” ì„ íƒì§€ê°€ ë‚¨ì•˜ìœ¼ë©°, Pnpmì˜ ë§¤ë ¥ì„ ì°¾ê¸°ë¡œí–ˆìŠµë‹ˆë‹¤.

## íŒ¨í‚¤ì§€ ë§¤ë‹ˆì € ë²¤ì¹˜ë§ˆí‚¹

ì•„ë˜ì˜ í…Œì´ë¸”ì€ pnpm ë¬¸ì„œì—ì„œ ì œê³µë˜ëŠ” íŒ¨í‚¤ì§€íŒŒì¼ ì„¤ì¹˜ ì†ë„ ë¹„êµ ë²¤ì¹˜ë§ˆí‚¹ ì…ë‹ˆë‹¤

![](/static/images/DEV/hutom-monorepo/bench-mark.png)

cacheê°€ ìˆëŠ”ê²½ìš°ì—ëŠ” ì´ˆë¡ìƒ‰, ì—†ëŠ” ê²½ìš°ì—ëŠ” ë…¸ë€ìƒ‰ìœ¼ë¡œ êµ¬ë¶„í–ˆìŠµë‹ˆë‹¤. Yarn(PnP)ëŠ” ì„ íƒì§€ì— ì—†ìœ¼ë¯€ë¡œ ë°°ì œí•˜ê³  ë³´ì‹œë©´ë©ë‹ˆë‹¤.

ê°ê°ì˜ ì¼€ì´ìŠ¤ ë³„ë¡œ ë³´ë”ë¼ë„ pnpmì„ ì‚¬ìš©í•œ ì‚¬ë¡€ê°€ ì„±ëŠ¥ìƒ ë¹ ë¥´ê¸°ë•Œë¬¸ì— ì¢‹ì€ ì„ íƒì§€ê°€ ë  ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ Pnpmì€ ì¤‘ì†ì„± ì¤‘ë³µ ì €ì¥ ë¬¸ì œë¥¼ ì˜ í•´ê²°í•˜ëŠ”ì§€ê°€ ê¶ê¸ˆí•©ë‹ˆë‹¤.

pnpmì˜ node_modules ë ˆì´ì•„ì›ƒì€ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¤‘ì²©ëœ ì¢…ì†ì„± êµ¬ì¡°ë¥¼ ë§Œë“­ë‹ˆë‹¤. node_modules ë‚´ì˜ ëª¨ë“  íŒ¨í‚¤ì§€ì˜ ëª¨ë“  íŒŒì¼ì€ [Content-addressable Store](https://pnpm.io/next/symlinked-node-modules-structure) ì— ëŒ€í•œ í•˜ë“œë§í¬ì…ë‹ˆë‹¤. bar@1.0.0ì— ì¢…ì†ëœ foo@1.0.0ì„ ì„¤ì¹˜í•œë‹¤ê³  ê°€ì •í–ˆì„ë•Œ í•˜ê¸° êµ¬ì¡°ì²˜ëŸ¼ í•˜ë“œë§í¬í•©ë‹ˆë‹¤.

```markdown
node_modules
â””â”€â”€ .pnpm
â”œâ”€â”€ bar@1.0.0
â”‚ â””â”€â”€ node_modules
â”‚ â””â”€â”€ bar -> <store>/bar
â”‚ â”œâ”€â”€ index.js
â”‚ â””â”€â”€ package.json
â””â”€â”€ foo@1.0.0
â””â”€â”€ node_modules
â””â”€â”€ foo -> <store>/foo
â”œâ”€â”€ index.js
â””â”€â”€ package.json
```

ìœ„ì˜ êµ¬ì¡°ëŠ” ì‹¤ì œë¡œ ì„¤ì¹˜ë˜ëŠ” node_modulesì˜ í˜•íƒœì…ë‹ˆë‹¤. ê·¸ë˜í”„ êµ¬ì¡°ë¥¼ êµ¬ì¶•í•˜ê¸° ìœ„í•´ ì‹¬ë³¼ë¦­ ë§í¬ê°€ ìƒì„±ë©ë‹ˆë‹¤.

ë‘ íŒ¨í‚¤ì§€ëŠ” ëª¨ë‘ node_modules í´ë”ë‚´ì˜ í•˜ìœ„ í´ë”ì— í•˜ë“œ ë§í¬ ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ í•˜ë“œë§í¬êµ¬ì¡°ëŠ” íŒ¨í‚¤ì§€ê°€ ìŠ¤ìŠ¤ë¡œë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤. fooëŠ” require(â€™foo/pacakage.json') or import \* as package from â€œfoo/package.jsonâ€ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì–´ì•¼í•©ë‹ˆë‹¤.

ë‹¤ìŒì€ ì¢…ì†ì„± ì‹¬ë³¼ë¦­ ë§í¬ë¡œ barëŠ” foo@1.0.0/node_modeulsì— ì‹¬ë³¼ë¦­ ë§í¬ë©ë‹ˆë‹¤.

```markdown
node_modules
â””â”€â”€ .pnpm
â”œâ”€â”€ bar@1.0.0
â”‚ â””â”€â”€ node_modules
â”‚ â””â”€â”€ bar -> <store>/bar
â””â”€â”€ foo@1.0.0
â””â”€â”€ node_modules
â”œâ”€â”€ foo -> <store>/foo
â””â”€â”€ bar -> ../../bar@1.0.0/node_modules/bar
```

ë‹¤ìŒìœ¼ë¡œ ì§ì ‘ ì¢…ì†ì„±ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. fooëŠ” í”„ë¡œì íŠ¸ì˜ ì¢…ì†ì„±ì´ë¯€ë¡œ ë£¨íŠ¸ node_modules í´ë”ì— ì‹¬ë³¼ë¦­ ë§í¬ë©ë‹ˆë‹¤.

```markdown
node_modules
â”œâ”€â”€ foo -> ./.pnpm/foo@1.0.0/node_modules/foo
â””â”€â”€ .pnpm
â”œâ”€â”€ bar@1.0.0
â”‚ â””â”€â”€ node_modules
â”‚ â””â”€â”€ bar -> <store>/bar
â””â”€â”€ foo@1.0.0
â””â”€â”€ node_modules
â”œâ”€â”€ foo -> <store>/foo
â””â”€â”€ bar -> ../../bar@1.0.0/node_modules/bar
```

ê²°ê³¼ì ìœ¼ë¡œ Pnpmë¥¼ ì‚¬ìš©í•˜ë©´ ëª¨ë“  ì¢…ì†ì„±ì€ ì „ì—­ ìŠ¤í† ì–´ì— ë¬¼ë¦¬ì ìœ¼ë¡œ í•œë²ˆë§Œ ì €ì¥ë˜ì–´ SSOT(ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›)ì„ êµ¬ì„±í•˜ë©° ë””ìŠ¤í¬ ê³µê°„ì„ ì ˆì•½í•˜ê²Œ ë©ë‹ˆë‹¤.

# í„°ë³´ë ˆí¬

TurboRepoì˜ ì£¼ìš” ë¯¸ì…˜ì€ ëª¨ë…¸ë ˆí¬ í™˜ê²½ì—ì„œ ê°œë°œìê°€ ì¡°ê¸ˆ ë” ì‰½ê³  ë¹ ë¥´ê²Œ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ ë¹Œë“œ ë„êµ¬ë¥¼ ì œê³µí•˜ëŠ”ê²ƒì…ë‹ˆë‹¤.

## Content-aware-hashing

- íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ì•„ë‹Œ ì½˜í…ì¸ ë¥¼ ì¸ì‹í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ì‹±ì„ ì§€ì›í•©ë‹ˆë‹¤.
- ëª¨ë“  íŒŒì¼ì„ ë‹¤ì‹œ ë¹Œë“œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ ë³€ê²½ëœ íŒŒì¼ë§Œ ë¹Œë“œí•©ë‹ˆë‹¤.

## Pruned subsets

ëª¨ë…¸ë ˆí¬ëŠ” ë½íŒŒì¼ì„ ì „ì—­ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤. reserach-db ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì™€ surggram ì›Œí¬ìŠ¤í˜ì´ìŠ¤ê°€ ìˆìŠµë‹ˆë‹¤. surggramì˜ ë””íœë˜ì‹œê°€ ë³€ê²½ëœë‹¤ë©´ ì „ì—­ ë½íŒŒì¼ì— ë°˜ì˜ë©ë‹ˆë‹¤.

ë””íœë˜ì‹œê°€ ë³€ê²½ë˜ì§€ì•Šì€ research-db ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ ë„ì»¤ë¡œ ë¹Œë“œí• ë•Œ ë½íŒŒì¼ì´ ë³€ê²½ëœê²ƒì„ ë³´ê³  ìƒˆë¡œ ë””íœë˜ì‹œë¥¼ ì„¤ì¹˜í•˜ê¸° ì‹œì‘í• ê²ƒì…ë‹ˆë‹¤.

ë½íŒŒì¼ì„ ì „ì—­ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë¬¸ì œë¼ë©´ ë¹Œë“œí•  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë§Œ ë–¼ì–´ë‚´ ë½íŒŒì¼ì„ ë„ì»¤ì—ê²Œ ì „ë‹¬í•´ì£¼ë©´ í¸í•˜ì§€ì•Šì„ê¹Œìš”?

```markdown
â”œâ”€â”€ apps
| â”œâ”€â”€ research-db // design-system, research-db-oas ì‚¬ìš©
| | â”œâ”€â”€ src/..
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ surggram // design-system, surggram-oas ì‚¬ìš©
| â”œâ”€â”€ src/..
| â”œâ”€â”€ package.json
|
â”œâ”€â”€ packages
| â”œâ”€â”€ design-system
| | â”œâ”€â”€ src/..
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ research-db-oas
| | â”œâ”€â”€ src/..
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ surggram-oas
| â”œâ”€â”€ src/..
| â”œâ”€â”€ package.json
|
â”œâ”€â”€ pnpm-lock.yaml // ì „ì—­ ë½ íŒŒì¼!
```

ìœ„ì™€ ê°™ì€ êµ¬ì¡°ë¡œ ë˜ì–´ìˆë‹¤ê³  ê°€ì •í•˜ê³  surggramì„ ë¹Œë“œí•´ì•¼í•˜ëŠ” ìƒí™©ì´ë¼ê³  ê°€ì •í•´ë´…ì‹œë‹¤. surggram íŒ¨í‚¤ì§€ëŠ” design-systemê³¼ surggram-oas íŒ¨í‚¤ì§€ë§Œ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤.

í„°ë³´ë ˆí¬ë¥¼ ì‚¬ìš©í•˜ì§€ì•Šê³  workspace í•„ë“œë§Œì„ ì‚¬ìš©í•´ì„œ Docker ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ì•¼í•˜ëŠ” ìƒí™©ì„ ìƒê°í•´ë´…ì‹œë‹¤.

**Dockerfile (Prune ì‚¬ìš© X)**

```docker
FROM node:18-alpine AS base

FROM base AS builder
WORKDIR /app
COPY . .

FROM base AS installer
WORKDIR /app

# í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ì„ ë³µì‚¬
COPY --from=builder /app/apps/surggram/ . ./apps/surggram
COPY --from=builder /app/package/design-system/ . ./package/design-system
COPY --from=builder /app/package/surggram-oas/ . ./package/surggram-oas

# ì—¬ê¸°ì„œ ë¬¸ì œ ë°œìƒ!
COPY --from=builder /app/out/pnpm-lock.yaml ./pnpm-lock.yaml

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN pnpm install

# Build the project
WORKDIR /app/apps/surggram
RUN pnpm build

# Stand Alone ì„¤ì •ìœ¼ë¡œ Runner Stage
FROM base AS runner

# ì¤‘ê°„ ìƒëµ

CMD node apps/surggram/server.js
```

ì–´ì°Œì €ì°Œí•´ì„œ í•„ìš”í•œ íŒ¨í‚¤ì§€ë“¤ì„ ë¹Œë“œì™€ ì¸ìŠ¤í†¨ ìŠ¤í…Œì´ì§€ì— ëª¨ì•„ì™”ë‹¤ê³  ê°€ì •í•´ë´…ì‹œë‹¤. í•˜ì§€ë§Œ ëª¨ë…¸ë ˆí¬ ë¹Œë“œ í™˜ê²½ì—ì„œ ë½íŒŒì¼ì€ ì „ì—­ì— ì¡´ì¬í•©ë‹ˆë‹¤. ë½íŒŒì¼ì€ ê°€ì§€ì¹˜ê¸°ê°€ ë˜ì–´ìˆì§€ì•Šì•„ ë¹Œë“œíƒ€ê²Ÿì¸ SurgGram íŒ¨í‚¤ì§€ì˜ ì˜ì¡´ì„±ë§Œ ì„¤ì¹˜ë˜ëŠ”ê²ƒì´ ì•„ë‹ˆë¼ ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„±ê¹Œì§€ ì„¤ì¹˜ë ê²ƒì…ë‹ˆë‹¤.

ì´ëŠ” ë˜ ì ì¬ì ìœ¼ë¡œ ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œì— ì‚¬ìš©ë  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì™€ ê´€ë ¨ ì—†ëŠ” ì˜ì¡´ì„± ë³€ê²½ìœ¼ë¡œ `ìºì‹œ miss`ë¥¼ ì•¼ê¸°í• ìˆ˜ë„ìˆìŠµë‹ˆë‹¤.

ì´ëŸ°ë¬¸ì œë¥¼ í„°ë³´ë ˆí¬ë„ ì§„ì‘ì— íŒŒì•…í•˜ê³ ìˆê³  **Prune**ì´ë¼ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•´ì¤ë‹ˆë‹¤.

`turbo prune --scope="surggramâ€` ë¼ê³  CLI ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¬¼ì„ ì–»ìŠµë‹ˆë‹¤.

```markdown
â”œâ”€â”€ apps
| â”œâ”€â”€ surggram // design-system, surggram-oas ì‚¬ìš©
| â”œâ”€â”€ src/..
| â”œâ”€â”€ package.json
|
â”œâ”€â”€ packages
| â”œâ”€â”€ design-system
| | â”œâ”€â”€ src/..
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ surggram-oas
| â”œâ”€â”€ src/..
| â”œâ”€â”€ package.json
|
â”œâ”€â”€ pnpm-lock.yaml // ê°€ì§€ì¹˜ê¸°ëœ ì „ì—­ ë½ íŒŒì¼!
```

ë¬´ì—‡ì´ ë‹¬ë¼ì¡ŒëŠ”ì§€ ëˆˆì— ë³´ì´ì‹œë‚˜ìš”? SurgGramê³¼ ê´€ë ¨ëœ íŒ¨í‚¤ì§€ë“¤ë§Œ ê°€ì§€ì¹˜ê¸°ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì œê°€ ìš°ë ¤í–ˆë˜ê²ƒì€ ì „ì—­ ë½íŒŒì¼ì„ ë¶ˆí•„ìš”í•œ ì˜ì¡´ì„± ë¬¸ì œì˜€ì£ ?

ì•„ë˜ì˜ ì‚¬ì§„ì€ ì „ì—­ ë½íŒŒì¼ê³¼ prune ê¸°ëŠ¥ìœ¼ë¡œ ë§Œë“¤ì–´ë‚¸ ê°€ì§€ì¹˜ê¸°ëœ ë½íŒŒì¼ì…ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/lockfile.png)

ë¬´ë ¤ 900ì¤„ì´ë‚˜ ì°¨ì´ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. ì´ë¡œì¨ SurgGramê³¼ ê´€ë ¨ëœ íŒ¨í‚¤ì§€ë“¤ë§Œ ë½íŒŒì¼ì— ìƒì„±ì´ ë˜ì—ˆë‹¤ëŠ”ê²ƒì…ë‹ˆë‹¤.

ë”ìš± ë§¤ë ¥ì ì¸ê²ƒì€ â€”docker ì˜µì…˜ì…ë‹ˆë‹¤. ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë½‘ì•„ì¤ë‹ˆë‹¤.

```txt
â”œâ”€â”€ full // ì§‘ì¤‘!!
| â”œâ”€â”€ apps
| | â”œâ”€â”€ surggram
| | â”œâ”€â”€ src/..
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ packages
| â”œâ”€â”€ design-system
| | â”œâ”€â”€ src/..
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ surggram-oas
| â”œâ”€â”€ src/..
| â”œâ”€â”€ package.json
|
â”œâ”€â”€ json // ì§‘ì¤‘!!
| â”œâ”€â”€ apps
| | â”œâ”€â”€ surggram
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ packages
| â”œâ”€â”€ design-system
| | â”œâ”€â”€ package.json
| |
| â”œâ”€â”€ surggram-oas
| â”œâ”€â”€ package.json
|
â”œâ”€â”€ pnpm-lock.yaml
```

full ë””ë ‰í„°ë¦¬ì—ì„œ package.json íŒŒì¼ë§Œì„ ê°€ì ¸ì™€ì„œ ë§Œë“¤ì–´ì§„ json ë””ë ‰í„°ë¦¬ë¼ëŠ”ì ì´ ëˆˆì— ë³´ì…ë‹ˆë‹¤.

`Install Stage(JSON) â†’ Build Stage(Full) â†’ â€¦`

ì´ì œ Install Stageì—ì„œ ì˜ì¡´ì„± ì„¤ì¹˜ì— í•„ìš”í•œ pnpm-lock.yamlê³¼ package.json ë§Œì„ ê°€ì§ˆìˆ˜ ìˆê²Œ ë˜ì—ˆê³ , ë”ì´ìƒ ì˜ì¡´ì„±ê³¼ ê´€ë ¨ë˜ì§€ì•Šì€ íŒŒì¼ì˜ ë³€ê²½ìœ¼ë¡œ ìºì‹œê°€ missë˜ëŠ” ì¼ì€ ìƒê¸°ì§€ ì•Šì„ê²ƒì…ë‹ˆë‹¤.

## Cloud caching

- í´ë¼ìš°ë“œ ë¹Œë“œ ìºì‹œë¥¼ íŒ€ì› ë° CI/CDì˜ í™˜ê²½ì¸ Github actionsì™€ ê³µìœ í•©ë‹ˆë‹¤.
- ë¡œì»¬í™˜ê²½ì„ ë„˜ì–´ í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œë„ ë¹ ë¥¸ ë¹Œë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.

ì•„ë˜ì˜ ì‚¬ì§„ì€ ê°ê° ì»´í“¨í„°ì—ì„œ ìºì‹œê°€ ë¡œì»¬ë¡œ ì €ì¥ë˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤. ì´ë¥¼ í´ë¼ìš°ë“œ ìºì‹œë¡œ ì˜¬ë ¤ì„œ ë¶ˆí•„ìš”í•œ ì¤‘ë³µì‘ì—…ì„ ì œê±° í•´ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í„°ë³´ë ˆí¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì—ë§Œ ìºì‹œë¥¼ ì €ì¥í•˜ë¯€ë¡œ ëª¨ë“  ì‘ì—… ì…ë ¥ì´ ë™ì¼í•˜ë”ë¼ë„ ë™ì¼í•œ ì‘ì—…(ë¹Œë“œ, ë¦°íŠ¸, í…ŒìŠ¤íŠ¸)ì„ ê° ë¨¸ì‹ ì—ì„œ ë‹¤ì‹œ ì‹¤í–‰í•´ì•¼ í•˜ë©°, ì´ëŠ” ëª…ë°±í•œ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ì…ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/local-cache.png)

íŒ€ì›ë“¤ê³¼ ê·¸ë¦¬ê³  CIí™˜ê²½ì—ì„œë„ í•˜ë‚˜ì˜ ìºì‹œë¥¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤ë©´ ì¡°ì§ ì „ì²´ì—ì„œ ì¤‘ë³µ ì‘ì—…ì„ ë°©ì§€í•˜ì—¬ ì‹œê°„ì„ ì ˆì•½í• ê²ƒì…ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/remote-cache.png)

### ë¦¬ëª¨íŠ¸ ìºì‹œ API ì œì‘

í„°ë³´ë ˆí¬ì—ì„œëŠ” ë¦¬ëª¨íŠ¸ ìºì‹œë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” API ì‚¬ì–‘ì„ ì¶©ì¡±í•˜ëŠ” ëª¨ë“  HTTP ì„œë²„ì—ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤ê³  ì•ˆë‚´í•©ë‹ˆë‹¤. Vercelì—ì„œ ì œê³µí•˜ëŠ” ì›ê²©ìºì‹œë¥¼ ì‚¬ìš©í•  ìˆ˜ ë„ìˆì§€ë§Œ,
êµ³ì´ Proë‚˜ Enterprise ìš”ê¸ˆì œë¥¼ ì‚¬ìš©í•˜ê¸°ê°€ ê»„ë„ëŸ½ê¸°ë„í•˜ë©° ë³‘ì› ë° í™˜ìì˜ ë°ì´í„°ì˜ ì•ˆì „ì„ ìœ„í•´ ì•ˆì „í•œ API ì„œë²„ë¥¼ ë§Œë“¤ê¸°ë¡œ í•©ë‹ˆë‹¤.

[turborepo-remote-cach](https://github.com/ducktors/turborepo-remote-cache)ì—ì„œ ì œê³µí•´ì£¼ëŠ” ì†ŒìŠ¤ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë©´ë©ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/supported-storage-provider.png)

fastifyë¥¼ ê¸°ë°˜ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ë¯¸ë¦¬ êµ¬í˜„ë˜ì–´ìˆëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ë”°ë¡œ ì‘ì—…ì—†ì´ ì„œë²„ë¥¼ ë„ìš°ëŠ”ê²ƒë§Œìœ¼ë¡œë„ ì›ê²©ìºì‹±ì´ ì§€ì›ë˜ë©°, í˜„ì¬ íœ´í†°ì—ì„œ ì‚¬ìš©ì¤‘ì¸ **Google Cloud Storage**ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì»¤ìŠ¤í…€ ìºì‹œ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. [turborepo-remote-cach](https://github.com/ducktors/turborepo-remote-cache)ì—ì„œ ì†ŒìŠ¤ì½”ë“œë¥¼ í´ë¡ í•©ë‹ˆë‹¤.
2. Storage-Providerë¥¼ ìœ„í•œ ì„¤ì • ë° ê¸°íƒ€ í™˜ê²½ë³€ìˆ˜ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
3. Docker Imageë¥¼ ë§Œë“¤ì–´ Cloud Runê³¼ ê°™ì€ ì„œë²„ë¦¬ìŠ¤ í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•©ë‹ˆë‹¤.

ì»¤ìŠ¤í…€ ìºì‹œ ì„œë²„ë¥¼ êµ¬ì¶•í–ˆìœ¼ë‹ˆ ì»¤ìŠ¤í…€ ìºì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ êµ‰ì¥íˆ ê°„ë‹¨í•©ë‹ˆë‹¤.

Turborepoì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— `.turbo/config.json` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì•„ë˜ì™€ ê°™ì€ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.

- teamid : ì»¤ìŠ¤í…€ ìºì‹œ ì„œë²„ì˜ teamidë¥¼ ê¸°ì…í•©ë‹ˆë‹¤.
- token : ì»¤ìŠ¤í…€ ìºì‹œ ì„œë²„ì˜ tokenë¥¼ ê¸°ì…í•©ë‹ˆë‹¤.
- apiurl : ì»¤ìŠ¤í…€ ìºì‹œ ì„œë²„ì˜ Urlì„ ê¸°ì…í•©ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/result-remote-cache.png)

ë§ˆì§€ë§‰ ì¤„ì„ ë³´ë©´ `Remote caching enabled`ë¼ëŠ” ë¬¸êµ¬ê°€ ìˆìŠµë‹ˆë‹¤! ì´ë¡œì„œ ë¦¬ëª¨íŠ¸ìºì‹œë¥¼ ì œê³µí•˜ëŠ” http ì„œë²„ëŠ” ìƒì„±í–ˆìŠµë‹ˆë‹¤.

# ë²„ì „ ê´€ë¦¬

íœ´í†°ì—ì„œ ë§Œë“¤ì–´ì§€ê³  ìˆëŠ” ì œí’ˆë“¤ì„ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” ì œí’ˆì˜ ë²„ì „ì„ ë¨¼ì € ì´í•´í•´ì•¼í•©ë‹ˆë‹¤! ìš°ë¦¬ëŠ” í•œ ì œí’ˆì„ ë§Œë“¤ê¸°ìœ„í•´ ì—¬ëŸ¬ë¶€ì„œì™€ ë²„ì „ì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.

ì œí’ˆì˜ í†µì¼ëœ ë²„ì „ ì •ì±…ì„ ê°€ì§€ê¸° ìœ„í•´ì„œëŠ” ìœ ì˜ì ì¸ ë²„ì „ì„ ì‚¬ìš©í•´ì•¼í•©ë‹ˆë‹¤. [ìœ ì˜ì  ë²„ì „](https://semver.org/lang/ko/)ì´ë€ ì œí’ˆì— ë²„ì „ì„ ì–´ë–»ê²Œ ë¶€ì—¬í•˜ê³  ê´€ë¦¬í•´ì•¼í•˜ëŠ”ì§€ì— ëŒ€í•œ ê·œì¹™ì…ë‹ˆë‹¤.

íœ´í†°ì—ì„œëŠ” ìœ ì˜ì ë²„ì „ì„ ì‚¬ìš©í•˜ì§€ë§Œ ì—¬ëŸ¬ ìœ ê´€ë¶€ì„œì™€ í˜‘ì—…ì„ í•´ì•¼í•˜ê¸°ë•Œë¬¸ì— **pre-release-version**ê³¼ **pre-release-code**ê°€ ì¼ë°˜ì ì¸ ìœ ì˜ì ë²„ì „ê³¼ëŠ” ë‹¤ë¥´ê²Œ ì‚¬ìš©í•˜ê³ ìˆìŠµë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/version.png)

- **major**, **minor**, **patch** ì€ ìœ ì˜ì ë²„ì „ê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•©ë‹ˆë‹¤ ğŸ™‚
  - **major**, **minor**, **patch**ëŠ” PMíŒ€ì—ì„œ ì •í•´ì£¼ì–´ ëª¨ë“  ë¶€ì„œê°€ ê³µìœ í•˜ëŠ” ë²„ì „ì…ë‹ˆë‹¤.
- **stage**ëŠ” êµ¬í˜„ë‹¨ê³„ì™€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
  - êµ¬í˜„ë‹¨ê³„ : **patch** ë²„ì „ ë’¤ì— `-dev` ë¥¼ ë¶™ì—¬ ì‚¬ìš©í•˜ë©° ëª‡ë²ˆì§¸ ë‹¨ê³„ì¸ì§€ ìˆ«ìë¡œ í‘œê¸°í•©ë‹ˆë‹¤.
    - ex) `v1.0.0-dev1`, `v1.0.0-dev2`, `v1.0.0-dev3`
  - ì‹œìŠ¤í…œ ë‹¨ê³„ : V&VíŒ€ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ë‹¨ê³„ë¡œ êµ¬í˜„ë‹¨ê³„ì™€ ë§ˆì°¬ê°€ì§€ì˜ ì»¨ë²¤ì…˜ì„ ë”°ë¦…ë‹ˆë‹¤.
    - ex) `v1.0.0-vnv1`, `v1.0.0-vnv2`
  - **stage**ê°€ ë°˜ë³µì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ” ê²½ìš° **stage**ë’¤ì— ìˆ«ìë¥¼ ë¶™ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **build**ëŠ” PLT íŒ€ì´ **stage**ì—ì„œ ëª‡ë²ˆì§¸ ë¹Œë“œí–ˆëŠ”ì§€ë¥¼ ëª…ì‹œí•©ë‹ˆë‹¤.
  - **build** ì •ë³´ëŠ” ìì—°ìˆ˜ë¡œ í‘œê¸°í•˜ë©° **stage**ê°€ ë³€ê²½ë˜ì–´ë„ **build** ìˆ«ìëŠ” ì´ˆê¸°í™” í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  - ex) `v1.0.0-vnv1-build1`, `v1.0.0-vnv1-build2`, `v1.0.0-vnv2-build3`

# ë¸Œëœì¹˜ ì „ëµ ë¹„êµ

## Git Flow

![](/static/images/DEV/hutom-monorepo/git-flow.png)

ìœ„ì˜ ê·¸ë¦¼ì€ ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ GitFlow ì „ëµì…ë‹ˆë‹¤. íœ´í†°ì˜ í”„ë¡œì íŠ¸ëŠ” ê°ê° ë°°í¬ ì£¼ê¸°ê°€ ë‹¤ë¥¼ìˆ˜ë„ìˆìœ¼ë©°, ìš´ì˜ë°©ì‹ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì´ì— ë§ì¶° ìœ ì—°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼í•©ë‹ˆë‹¤.

### Git Flow ëŠ” ì™œ ëª¨ë…¸ë ˆí¬ì—ì„œ ì‚¬ìš©í•˜ê¸° ì–´ë ¤ìš´ê°€

**ëª¨ë…¸ë ˆí¬ì—ì„œëŠ” GitFlowë¡œëŠ” ë³µì¡ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.**

- ë³µì¡ì„± ì¦ê°€
  - ëª¨ë…¸ë ˆí¬ëŠ” ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ í•˜ë‚˜ì˜ ì €ì¥ì†Œì—ì„œ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì— ë³µì¡í•©ë‹ˆë‹¤. GitFlowëŠ” ë¸Œëœì¹˜ ê´€ë¦¬ì „ëµì´ ë³µì¡í•œë° ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì˜ ë‹¤ì–‘í•œ ë¸Œëœì¹˜ë¥¼ ê´€ë¦¬í•˜ê¸°ì—ëŠ” ë¶€ì ì ˆí•©ë‹ˆë‹¤.
- ë™ê¸°í™” ë¬¸ì œ
  - GitFlowëŠ” feat, develop, main ë¸Œëœì¹˜ ë“±ì„ í†µí•´ ì‘ì—…ì„ í•©ë‹ˆë‹¤. ëª¨ë…¸ë ˆí¬ì—ì„œëŠ” ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì˜ ë¸Œëœì¹˜ê°€ ì„œë¡œ ì—°ê´€ë˜ì–´ ì„œë¡œ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆì–´ ë™ê¸°í™”ê°€ ì–´ë µìŠµë‹ˆë‹¤.
- ë¦´ë¦¬ì¦ˆ ê´€ë¦¬ì˜ ì–´ë ¤ì›€
  - ëª¨ë…¸ë ˆí¬ì—ì„œëŠ” ì—¬ëŸ¬ í”„ë¡œì íŠ¸ê°€ ë™ì‹œì— ë¦´ë¦¬ì¦ˆ ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. GitFlowëŠ” ê°œë³„ í”„ë¡œì íŠ¸ì˜ ë¦´ë¦¬ì¦ˆë¥¼ ê´€ë¦¬í•˜ëŠ”ë°ëŠ” ì í•©í•˜ì§€ë§Œ ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ëª¨ë…¸ë ˆí¬ì—ì„œëŠ” ë¦´ë¦¬ì¦ˆë¥¼ ì¡°ìœ¨í•´ì•¼ í•˜ë¯€ë¡œ ë¦´ë¦¬ì¦ˆ ë³‘ëª©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Trunk-Based Development

![](/static/images/DEV/hutom-monorepo/tbd.png)

**Trunk-Based Development** ë€ ì†ŒìŠ¤ ì œì–´ ë„êµ¬ì—ì„œ ë¸Œëœì¹˜ë¥¼ ì–´ë–»ê²Œ ê´€ë¦¬í• ì§€ì— ëŒ€í•œ ì „ëµì…ë‹ˆë‹¤. ê°œë°œìë“¤ì€ ë§ˆìŠ¤í„°ì—ì„œ í˜‘ì—…í•˜ê³ , ê¸´ ì‘ì—… ë‹¨ìœ„ì˜ ë¸Œëœì¹˜ ìƒì„±ì„ í”¼í•´ì•¼í•©ë‹ˆë‹¤. ê·¸ë ‡ê²Œ í•¨ìœ¼ë¡œì„œ í˜‘ì—… ê°„ ì¶©ëŒì„ ìµœì†Œí™”í•˜ê³  ë¹Œë“œê°€ ì‹¤íŒ¨ë˜ëŠ” ìƒíƒœë¥¼ ë§‰ìŠµë‹ˆë‹¤.

ì´ ëª¨ë¸ì˜ ê°€ì¥ ì£¼ìš”í•œ íŠ¹ì§•ì€ íŠ¸ë í¬ë¼ ë¶ˆë¦¬ëŠ” ë§ˆìŠ¤í„° ë¸Œëœì¹˜ë¥¼ í•­ìƒ ë°°í¬ ê°€ëŠ¥í•œ ì˜¬ë°”ë¥¸ ìƒíƒœë¡œ ìœ ì§€í•˜ëŠ” ê²ƒì´ê³  ì´ë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•œ ì£¼ìš” ê·œì¹™ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

### **ê°œë°œê·œì¹™**

- ê°œë°œì€ ë¸Œëœì¹˜ í‘¸ì‹œë¡œ ì§„í–‰í•©ë‹ˆë‹¤.
  - ë¸Œëœì¹˜ í‘¸ì‹œ: ë§ˆìŠ¤í„°ì—ì„œ íŒŒìƒëœ í”¼ì³ ë¸Œëœì¹˜ë¥¼ ìƒì„±í•œ í›„ PRì„ í†µí•´ ë§ˆìŠ¤í„°ë¡œ í‘¸ì‹œí•©ë‹ˆë‹¤.
- íœ´í†° í”„ë¡ íŠ¸ì—”ë“œ íŒŒíŠ¸ì—ì„œëŠ” ê°œë°œ ì¤‘ ì§ì ‘ í‘¸ì‹œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ë¸Œëœì¹˜ í‘¸ì‹œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- í”¼ì³ ë¸Œëœì¹˜ëŠ” ê°€ëŠ¥í•œ ì‘ì€ ì‘ì—… ë‹¨ìœ„ë¥¼ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.
- ì¥ê¸°ê°„ ì§€ì†í•˜ì—¬ì•¼ í•˜ëŠ” í”¼ì³ ê°œë°œì˜ ê²½ìš° í”¼ì³ í”Œë˜ê·¸ì™€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ ì‘ì—… ë‹¨ìœ„ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤.

### **ë°°í¬ ê·œì¹™**

- ë°°í¬ëŠ” ë¸Œëœì¹˜ ë°°í¬ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.
  - ë¸Œëœì¹˜ ë°°í¬: ë§ˆìŠ¤í„°ì—ì„œ í•„ìš” ì‹œì ì— ë°°í¬ ë¸Œëœì¹˜ë¥¼ ìƒì„± í›„ ë°°í¬ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
- íœ´í†° í”„ë¡ íŠ¸ì—”ë“œ íŒŒíŠ¸ì—ì„œëŠ” í•„ìš”ì— ë”°ë¼ ì§ì ‘ ë°°í¬ì™€ ë¸Œëœì¹˜ ë°°í¬ë¥¼ í˜¼ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.
- ë°°í¬ ë¸Œëœì¹˜ì—ì„œ ì‘ì—…í•œ ê²°ê³¼ëŠ” ë§ˆìŠ¤í„°ë¡œ ë¨¸ì§€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ë°°í¬ ë¸Œëœì¹˜ì—ì„œ ì¶”ê°€ ì‘ì—…ì´ í•„ìš”í•  ê²½ìš° ë§ˆìŠ¤í„°ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„ í•´ë‹¹ ì»¤ë°‹ì„ ì²´ë¦¬í”½í•˜ì—¬ ê°€ì ¸ì˜µë‹ˆë‹¤.

í”„ë¡œì íŠ¸ë§ˆë‹¤ ë°°í¬ ì£¼ê¸°ê°€ ë‹¤ë¥¼ìˆ˜ë„ìˆìœ¼ë©°, ìš´ì˜ë°©ì‹ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ì´ì— ë§ì¶° ìœ ì—°í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ì•¼í•©ë‹ˆë‹¤.

ì´ì—ë”°ë¼ íœ´í†°ì˜ í”„ë¡ íŠ¸ì—”ë“œ íŒŒíŠ¸ëŠ” ê¸°ì¡´ì˜ **GitFlow**ë¥¼ ë²„ë¦¬ê³  ìƒˆë¡­ê²Œ **Trunk Based Development(TBD)**ë¡œ í•´ê²°í•´ë³´ë ¤í•©ë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ Feature Flagë¥¼ ë¨¼ì € ë„ì…í•´ì•¼í•©ë‹ˆë‹¤.

## Feature Flag

ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” ê¸°ëŠ¥ì„ ë™ì ìœ¼ë¡œ í† ê¸€ í•  ìˆ˜ ìˆëŠ” ìŠ¤ìœ„ì¹˜ë¡œ ì„œë¹„ìŠ¤ ì¤‘ì¸ ì•±ì— ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê±°ë‚˜ ë³€ê²½í•  ë•Œ ê·¸ ë³€ê²½ì‚¬í•­ì„ ì¼ë¶€ ì‚¬ìš©ìì—ê²Œë§Œ ë³´ì´ê²Œ í•˜ê±°ë‚˜ ìˆ¨ê¸°ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í”¼ì²˜í”Œë˜ê·¸ì˜ ë³´í¸ì ì¸ ì‚¬ìš©ë°©ë²•ì€ ì‚¬ìš©ìë“¤ì—ê²Œ ì‹¤í—˜ì  í˜¹ì€ ì œí•œëœ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ëŠ” [ë²„ì „](https://www.notion.so/204c8fae53284353ad47dc89a69e886d?pvs=21)ì´ ì¡´ì¬í•©ë‹ˆë‹¤. í”¼ì²˜í”Œë˜ê·¸ê°€ ì œí•œëœ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ëŠ”ê²ƒì—ì„œ ì˜ê°ì„ ë°›ì•„ ë²„ì „ì—ë”°ë¼ ê¸°ëŠ¥ì˜ ë²”ìœ„ë¥¼ ì œí•œí•˜ë„ë¡ í”¼ì²˜í”Œë˜ê·¸ë¥¼ ì„¤ê³„í•´ë³´ëŠ” ë°©ë²•ì„ ë– ì˜¬ë¦¬ê²Œë˜ì—ˆìŠµë‹ˆë‹¤.

### ë²„ì „ì— ë”°ë¼ ê¸°ëŠ¥ì œê³µì˜ ì—¬ë¶€ë¥¼ ì„ íƒí•˜ë„ë¡ Feature Flag ë¥¼ ì„¤ê³„í•´ë³´ì

**SurgGram**ì„ ë§Œë“¤ì–´ê°€ëŠ” **PLTíŒ€**ê³¼ ìœ ê´€ë¶€ì„œë“¤ì´ ìˆìŠµë‹ˆë‹¤.

**PMíŒ€**ì—ì„œ **Core Version**`(v0.1.0)`ì„ ì •í•´ì£¼ê³  ê¸°ëŠ¥ì˜ ë²”ìœ„ë¥¼ ì •í•´ì¤ë‹ˆë‹¤. (ë¡œê·¸ì¸ê¸°ëŠ¥ì„ ì˜ˆì‹œë¡œ ì„¤ëª…í•©ë‹ˆë‹¤)

**PLTíŒ€**ì€ ì •í•´ì§„ **Core Version**ì— ë§ê²Œ êµ¬í˜„ ë‹¨ê³„ì— ë“¤ì–´ê°€ê²Œë©ë‹ˆë‹¤. ê·¸ë ‡ê²Œ `v0.1.0-dev1` ë²„ì „ì´ íƒ„ìƒí•©ë‹ˆë‹¤.

```tsx
export const SURGGRAM_VERSION_0_1_0_DEV1 = {
  ë¡œê·¸ì¸: FeatureFlag.onDevelopment({
    // êµ¬í˜„ë‹¨ê³„ì´ë¯€ë¡œ ê°œë°œí™˜ê²½ì—ì„œë§Œ ì œê³µí•©ë‹ˆë‹¤.
    key: 'login',
    description: 'ë¡œê·¸ì¸ ê¸°ëŠ¥',
  }),
} as const
```

`v0.1.0-dev1`ì˜ í”¼ì²˜í”Œë˜ê·¸ë¥¼ ë§Œë“­ë‹ˆë‹¤. ì—¬ê¸°ì„œ í™•ì¸í• ê²ƒì€ ì„¸ê°€ì§€ì…ë‹ˆë‹¤. í˜„ì¬ ê¸°ëŠ¥ì´ ê°œë°œí™˜ê²½, ìŠ¤í…Œì´ì§•í™˜ê²½, ìš´ì˜í™˜ê²½ì— ë°°í¬ê°€ ë˜ì–´ë„ ë˜ëŠ” ìƒíƒœì¸ì§€ ì•„ë‹Œì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

`v0.1.0-dev1`ëŠ” êµ¬í˜„ë‹¨ê³„ì´ë¯€ë¡œ **development**ë§Œ trueë¡œ ë§Œë“¤ì–´ë†“ìŠµë‹ˆë‹¤.

`v0.1.0-dev1`ì—ì„œ ë¬´ì–¸ê°€ ë¬¸ì œê°€ìˆì–´ ë³´ì™„í•˜ê¸°ìœ„í•´ `v0.1.0-dev2` ë²„ì „ì´ íƒ„ìƒí•©ë‹ˆë‹¤.

```tsx
// hutom-frontend/packages/feature-flag/surggram/v0.1.0-dev2.ts
export const SURGGRAM_VERSION_0_1_0_DEV2 = {
  ...SURGGRAM_VERSION_0_1_0_DEV1,
} as const
```

ë°”ë¡œ ì•„ë˜ ë²„ì „ì¸ `v0.1.0-dev1` ì˜ í”¼ì²˜í”Œë˜ê·¸ë¥¼ ê°€ì ¸ì™€ì„œ êµ¬ì¡°ë¶„í•´í• ë‹¹í•´ì¤ë‹ˆë‹¤. ìœ—ë²„ì „ì€ í•˜ìœ„ë²„ì „ì˜ ê¸°ëŠ¥ì„ ëª¨ë‘ í¬í•¨í•´ì•¼í•˜ê¸°ë•Œë¬¸ì…ë‹ˆë‹¤. ë§Œì•½ í•˜ìœ„ë²„ì „ì˜ ê¸°ëŠ¥ì¤‘ ë³€ê²½ë˜ì–´ì•¼í•˜ëŠ”ê²ƒì´ ìˆë‹¤ë¼ë©´ ê¸°ëŠ¥ì˜ í‚¤ì˜ ê°’ì„ ë³€ê²½í•´ì£¼ë©´ë©ë‹ˆë‹¤. `v0.1.0-dev2` ì—ì„œëŠ” `v0.1.0-dev1` ì™€ ë¹„êµí•´ ë‹¬ë¼ì§„ê²Œì—†ìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ê°€ì ¸ê°‘ë‹ˆë‹¤.

`v0.1.0-dev2` ë¡œ êµ¬í˜„ë‹¨ê³„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. `v0.1.0-vnv1-build1` ë²„ì „ì´ íƒ„ìƒí•©ë‹ˆë‹¤.

```tsx
// hutom-frontend/packages/feature-flag/surggram/v0.1.0-vnv1-build1.ts
export const SURGGRAM_VERSION_0_1_0_VNV1_BUILD1 = {
  ...SURGGRAM_VERSION_0_1_0_DEV2,
  ë¡œê·¸ì¸: FeatureFlag.onStaging({
    // V&V ê²€ì¦ë‹¨ê³„ì´ë¯€ë¡œ ê°œë°œ, ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œë§Œ ì œê³µí•©ë‹ˆë‹¤.
    key: 'login',
    description: 'ë¡œê·¸ì¸ ê¸°ëŠ¥',
  }),
} as const
```

ê²€ì¦ë‹¨ê³„ì— ë“¤ì–´ì™”ìœ¼ë‹ˆ ìŠ¤í…Œì´ì§•í™˜ê²½ì—ì„œ ì œê³µí•´ì•¼í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ ë¡œê·¸ì¸ í”¼ì²˜í”Œë˜ê·¸ì˜ **staging** ì†ì„±ì„ trueë¡œ ë³€ê²½í•˜ì˜€ìŠµë‹ˆë‹¤.

1ì°¨ ê²€ì¦ë‹¨ê³„ì—ì„œ ìˆ˜ì •ì´ í•„ìš”í•´ì„œ `v0.1.0-vnv1-build2` ë²„ì „ì„ ë§Œë“¤ì–´ ë³€ê²½í•©ë‹ˆë‹¤. ì´í›„ ë‹¤ì‹œ V&VíŒ€ì—ê²Œ 2ì°¨ ê²€ì¦ì„ ìš”ì²­í•˜ê¸° ìœ„í•´ `v0.1.0-vnv2-build3` ë²„ì „ì„ ë§Œë“¤ì–´ì„œ ì œê³µí•©ë‹ˆë‹¤.

```tsx
// hutom-frontend/packages/feature-flag/surggram/v0.1.0-vnv2-build3.ts
export const SURGGRAM_VERSION_0_1_0_VNV2_BUILD3 = {
  ...SURGGRAM_VERSION_0_1_0_VNV1_BUILD2,
} as const
```

`v0.1.0-vnv2-build3` ì˜ ë¡œê·¸ì¸ í”¼ì²˜í”Œë˜ê·¸ëŠ” `v0.1.0-vnv1-build2` ì—ì„œ ìˆ˜ì •í–ˆì„ë¿ ê³µê°œë²”ìœ„ëŠ” ë‹¬ë¼ì§€ì§€ ì•Šì•˜ìœ¼ë‹ˆ ê·¸ëŒ€ë¡œ ê°€ì ¸ê°‘ë‹ˆë‹¤.

V&Vì˜ 2ì°¨ ê²€ì¦ì´ ì™„ë£Œëœí›„ ë²„ì „ì„ ë¦´ë¦¬ì¦ˆí•´ì•¼í•˜ëŠ” ìƒí™©ì´ ì™”ìŠµë‹ˆë‹¤. ì´ì œ `v0.1.0`ì„ ë¦´ë¦¬ì¦ˆ í•©ë‹ˆë‹¤.

```tsx
// hutom-frontend/packages/feature-flag/surggram/v0.1.0.ts
export const SURGGRAM_VERSION_0_1_0 = {
  ...SURGGRAM_VERSION_0_1_0_VNV2_BUILD3,
  ë¡œê·¸ì¸: FeatureFlag.onProduction({
    // V&V ê²€ì¦ì´ ì™„ë£Œë˜ì—ˆìœ¼ë‹ˆ ê°œë°œ, ìŠ¤í…Œì´ì§•, ìš´ì˜í™˜ê²½ ëª¨ë‘ ì œê³µ!
    key: 'login',
    description: 'ë¡œê·¸ì¸ ê¸°ëŠ¥',
  }),
} as const
```

`v0.1.0` ì€ ìš´ì˜í™˜ê²½ì—ì„œë„ ì œê³µì´ ë˜ì–´ì•¼í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ë¡œê·¸ì¸ ê¸°ëŠ¥ì˜ **production** ì†ì„±ì„ true ë¡œ ë³€ê²½í•´ì¤ë‹ˆë‹¤.

ì´ë ‡ê²Œ ë²„ì „ì— ë”°ë¼ ë‹¬ë¼ì§€ëŠ” ê³µê°œë²”ìœ„ì—ëŒ€í•œ í”¼ì²˜í”Œë˜ê·¸ ì„¤ê³„ëŠ” ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ ì–´ë–»ê²Œ ì¨ì•¼í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ë´ì•¼í•©ë‹ˆë‹¤.

```tsx
// hutom-frontend/packages/feature-flag/surggram/index.ts
export const LAST_VERSION_FEATURE_FLAG = SURGGRAM_VERSION_0_1_0

// scopeì˜ undefinedëŠ” Productionì—ì„œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì´ ì—†ì„ ë•Œë¥¼ ëŒ€ë¹„í•œ default ê°’ì…ë‹ˆë‹¤.
export const IS_ENABLED_FEATURE_FLAG = (
  key: keyof typeof LAST_VERSION_FEATURE_FLAG,
  scope: 'development' | 'staging' | undefined
) => {
  const featureFlag = FeatureFlag.findByFeatureFlagKey(LAST_VERSION_FEATURE_FLAG, key)

  return FeatureFlag.isEnabledByScope(featureFlag, scope || 'production')
}

// hutom-frontend/apps/surggram/src/(pages)/login/page.tsx
export default function LoginPage({ searchParams }: Props) {
  if (!IS_ENABLED_FEATURE_FLAG('ë¡œê·¸ì¸', searchParams.scope)) {
    redirect('/')
  }

  return <div>ë¡œê·¸ì¸ í˜ì´ì§€</div>
}
```

ìœ„ ë¶€í„° ì•„ë˜ë¡œ í•œë²ˆ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

- `LAST_VERSION_FEATURE_FLAG`
  - development / staging / production í”¼ì²˜í”Œë˜ê·¸ì˜ ì •ë³´ê°€ ë‹´ê²¨ìˆëŠ” ìµœì‹ í™”ëœ ë²„ì „ì˜ í”¼ì²˜í”Œë˜ê·¸ì…ë‹ˆë‹¤.
- `IS_ENABLED_FEATURE_FLAG`
  - `LAST_VERSION_FEATURE_FLAG` ì˜ íŠ¹ì • í”¼ì²˜í”Œë˜ê·¸ê°€ íŠ¹ì • í™˜ê²½ì—ì„œ ì œê³µ ê°€ëŠ¥í•œ ìƒíƒœì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

ì´ë ‡ê²Œ **@packages/feature-flag/surggram** íŒ¨í‚¤ì§€ì—ì„œ ì œê³µëœ í”¼ì²˜í”Œë˜ê·¸ ì •ë³´ë¡œ **@apps/surggram** ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í‚¤ì§€ì—ì„œ ê¸°ëŠ¥ì˜ ì œê³µ ì—¬ë¶€ë¥¼ ì—´ê³  ë‹«ì•„ì¤ë‹ˆë‹¤.

## TBD + Feature Flag

TBDëŠ” Trunk ë¸Œëœì¹˜ì—ì„œ í˜‘ì—…í•˜ë©°, ê¸´ ì‘ì—…ë‹¨ìœ„ì˜ ë¸Œëœì¹˜ ìƒì„±ì„ í”¼í•©ë‹ˆë‹¤. ê·¸ë ‡ê²Œ í•¨ìœ¼ë¡œì„œ í˜‘ì—… ê°„ì˜ ì¶©ëŒì„ ìµœì†Œí™”í•˜ë©° ë¹Œë“œê°€ ì‹¤íŒ¨í•˜ëŠ” ìƒíƒœë¥¼ ë§‰ìŠµë‹ˆë‹¤. ê°€ì¥ ì¤‘ìš”í•œê²ƒì€ **Trunk ë¸Œëœì¹˜**ëŠ” **í•­ìƒ ë°°í¬ê°€ ê°€ëŠ¥í•œ ì˜¬ë°”ë¥¸ ìƒíƒœë¡œ ìœ ì§€**í•˜ëŠ”ê²ƒì…ë‹ˆë‹¤.

ì´ ë§ì€ ì¦‰ **Trunk**ë¼ëŠ” ë‹¨ì¼ë¸Œëœì¹˜ì—ì„œ ê°œë°œí™˜ê²½ / ìŠ¤í…Œì´ì§•í™˜ê²½ / í”„ë¡œë•ì…˜í™˜ê²½ ëª¨ë‘ ë°°í¬ê°€ ê°€ëŠ¥í•œ ì˜¬ë°”ë¥¸ ìƒíƒœë¡œ ìœ ì§€ë¥¼ í•´ì•¼í•œë‹¤ëŠ” ë§ì´ ë©ë‹ˆë‹¤.

ê·¸ë˜ì„œ í”¼ì²˜í”Œë˜ê·¸ì— ê°œë°œí™˜ê²½ / ìŠ¤í…Œì´ì§•í™˜ê²½ / í”„ë¡œë•ê²½í™˜ê²½ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìƒíƒœì¸ì§€ë¥¼ ì²´í¬í•˜ëŠ” í”Œë˜ê·¸ë¥¼ ì‹¬ì–´ì¤¬ë˜ê²ƒì…ë‹ˆë‹¤.

í”¼ì²˜í”Œë˜ê·¸ ê¸°ëŠ¥ì´ í˜ì´ì§€ë‹¨ìœ„ì—ì„œ êº¼ì ¸ìˆë‹¤ë©´ ë£¨íŠ¸í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•˜ê³ , ì»´í¬ë„ŒíŠ¸ë‹¨ìœ„ì—ì„œ êº¼ì ¸ìˆë‹¤ë©´ ë³´ì´ì§€ì•Šë„ë¡ ì •ì˜í•˜ë©´ë©ë‹ˆë‹¤.

ì´ì œ ì–´ë–»ê²Œ ì§€ì†ì ìœ¼ë¡œ ì œê³µí•˜ë©° ì•ˆì •ì ìœ¼ë¡œ í…ŒìŠ¤íŒ…í–ˆëŠ”ì§€ next.js 14ë²„ì „ ê¸°ì¤€ìœ¼ë¡œ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.

ìš°ì„  í”¼ì²˜í”Œë˜ê·¸ì—ê²Œ í˜„ì¬ì˜ í™˜ê²½ì´ ì–´ëŠí™˜ê²½ì¸ì§€ ì–´ë–»ê²Œ ì œê³µí• ì§€ë¥¼ ìƒê°í•´ë³´ë‹¤ê°€ í™˜ê²½ë³€ìˆ˜ë¡œ Scopeë¥¼ ì œê³µí•´ì£¼ë©´ ë˜ê² ë‹¤ëŠ” ìƒê°ì„í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ëŸ°íƒ€ì„ì— ì–´ë–»ê²Œ í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ì— ì£¼ì…ì„ ì‹œí‚¬ì§€ë¥¼ ìƒê°í–ˆìŠµë‹ˆë‹¤.

í”„ë¡ íŠ¸ì—”ë“œì˜ ì„œë²„ëŠ” ì›¹ì„œë²„ì´ë¯€ë¡œ HTTP Requestë¥¼ ë°›ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  í”„ë¡ íŠ¸ì—”ë“œì˜ ì„œë²„ëŠ” Next.jsë¡œ ë§Œë“¤ì–´ì ¸ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ Next.jsì—ì„œ ì œê³µí•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ í•˜ê³  [ë¬¸ì„œ](https://nextjs.org/docs/app/building-your-application/routing/middleware#use-cases)ë¥¼ ì½ì–´ë³´ì•˜ìŠµë‹ˆë‹¤.

- **Path Rewriting**: Support A/B testing, feature rollouts, or legacy paths by dynamically rewriting paths to API routes or pages based on request properties
- **Feature Flagging**: Enable or disable features dynamically for seamless feature rollouts or testing.

í›Œë¥­í•©ë‹ˆë‹¤! ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ ìœ ì¦ˆì¼€ì´ìŠ¤ë¼ê³  ì†Œê°œí•˜ê³ ìˆê³  ì´ì œ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì œì–´í•˜ë©´ë©ë‹ˆë‹¤.

```tsx
export async function middleware(req: NextRequest) {
  const url = req.nextUrl.clone()

  switch (env.SCOPE) {
    case 'development': {
      if (!url.searchParams.has('scope')) {
        url.searchParams.set('scope', 'development')
        return NextResponse.redirect(url)
      }
      break
    }

    case 'staging': {
      if (!url.searchParams.has('scope')) {
        url.searchParams.set('scope', 'staging')
        return NextResponse.redirect(url)
      }
      break
    }
    case 'production': {
      if (url.searchParams.has('scope')) {
        url.searchParams.delete('scope')
        return NextResponse.redirect(url)
      }
      break
    }
  }

  return NextResponse.next()
}
```

Next.jsì˜ ë¯¸ë“¤ì›¨ì–´ëŠ” ìš”ì²­ì´ ì™„ë£Œë˜ê¸° ì „ì— ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìš”ì²­ì— ë”°ë¼ ìš”ì²­ ë˜ëŠ” ì‘ë‹µ í—¤ë”ë¥¼ ì¬ì‘ì„±í•˜ê±°ë‚˜ ë¦¬ë‹¤ì´ë ‰ì…˜ í˜¹ì€ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ë ‡ê²Œ ê°œë°œí™˜ê²½ê³¼ ìŠ¤í…Œì´ì§•í™˜ê²½ì—ì„œëŠ” ìŠ¤ì½”í”„ë¥¼ ì¿¼ë¦¬íŒŒëŒì¦ˆë¡œ ì œê³µí•˜ê³ , ìš´ì˜í™˜ê²½ì—ì„œëŠ” ì‹¤ì œ ìœ ì €ê°€ ì¿¼ë¦¬íŒŒëŒì¦ˆê°€ ì—†ì´ë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ ìŠ¤ì½”í”„ë¥¼ ì œê±°í•œì±„ ì œê³µí•©ë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/query-param-feature-flag.gif)

ê°œë°œí™˜ê²½ì—ì„œ basePathë¡œ ì ‘ê·¼í•œê²½ìš° ìë™ìœ¼ë¡œ ìŠ¤ì½”í”„ê°€ ì¿¼ë¦¬íŒŒëŒì¦ˆë¡œ ë¶™ê²Œë©ë‹ˆë‹¤! ì´ë ‡ê²Œ í”¼ì²˜í”Œë˜ê·¸ë¥¼ ì„œë²„ì—ê²Œ ì œê³µí•´ì£¼ê³ ìˆëŠ”ê²ƒê¹Œì§€ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

ê·¸ëŸ¬ë©´ ì´ì œ ì•ˆì •ì ìœ¼ë¡œ í”¼ì²˜í”Œë˜ê·¸ê°€ ë™ì‘í•˜ê³ ìˆëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸°ìœ„í•´ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.

```tsx
// í˜„ì¬ ê°œë°œì¤‘ì¸ ë²„ì „
export const SURGGRAM_VERSION_0_1_0_DEV1 = {
  ë¡œê·¸ì¸: FeatureFlag.onDevelopment({
    key: 'ë¡œê·¸ì¸',
    description: 'ë¡œê·¸ì¸ ê¸°ëŠ¥',
  }),
} as const

// ë¡œê·¸ì¸ í˜ì´ì§€
const LoginPage = ({ searchParams }: Props) => {
  if (!IS_ENABLED_FEATURE_FLAG('ë¡œê·¸ì¸', searchParams.scope)) {
    redirect(`/`)
  }

  return <div>ë¡œê·¸ì¸ í˜ì´ì§€</div>
}
```

ë¡œê·¸ì¸ í˜ì´ì§€ì˜ ê¸°ëŠ¥ì œê³µë²”ìœ„ëŠ” ì•„ë˜ì™€ê°™ë‹¤ê³  ìƒí™©ì„ ê°€ì •í•´ ë´…ë‹ˆë‹¤.

- ê°œë°œí™˜ê²½ : `**On**`
- ìŠ¤í…Œì´ì§•í™˜ê²½ : `**Off**`
- í”„ë¡œë•ì…˜í™˜ê²½ : `**Off**`

ì´ë¥¼ ì‹œë‚˜ë¦¬ì˜¤ë¡œ E2Eí…ŒìŠ¤íŠ¸ ë„êµ¬ì¸ Cypressì˜ ë„ì›€ì„ ë°›ì•„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•´ ë´…ë‹ˆë‹¤. í”¼ì²˜í”Œë˜ê·¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” E2Eí…ŒìŠ¤íŠ¸ëŠ” íŒ¨í‚¤ì§€ì˜ `**/cypress/e2e/feature-flags**` í´ë”ì—ì„œ ê´€ë¦¬í•˜ë„ë¡ í•´ë‘ì—ˆìŠµë‹ˆë‹¤.

```tsx
describe('Login FeatureFlag í…ŒìŠ¤íŠ¸', () => {
  it('development í™˜ê²½ì—ì„œëŠ” í™”ë©´ì´ ë³´ì¸ë‹¤.', () => {
    cy.visit('/login?scope=development')

    cy.location().should((location) => {
      expect(location.pathname).to.eq('/login')
    })
  })

  it('staging í™˜ê²½ì—ì„œëŠ” ëœë”©í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ëœë‹¤.', () => {
    cy.visit('/login?scope=staging')

    cy.location().should((location) => {
      expect(location.pathname).to.eq('/')
    })
  })

  it('production í™˜ê²½ì—ì„œëŠ” ëœë”©í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ëœë‹¤.', () => {
    cy.visit('/login')

    cy.location().should((location) => {
      expect(location.pathname).to.eq('/')
    })
  })
})
```

ê° ì¼€ì´ìŠ¤ì—ë§ê²Œ ì‹œë‚˜ë¦¬ì˜¤ëŒ€ë¡œ ì¼€ì´ìŠ¤ë¥¼ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

![](/static/images/DEV/hutom-monorepo/e2e.gif)

# ì°¸ê³ ìë£Œ

- [ë²„ì „ê´€ë¦¬ ì‹œìŠ¤í…œ ì „ëµ](https://www.notion.so/474f3d9024cf4d2fbdf365e6ff27eeeb?pvs=21)
- [Yarn berry](https://www.notion.so/Yarn-berry-4128ad841a5849ea9d39186fe888a0d2?pvs=21)
- [node_modulesë¡œë¶€í„° ìš°ë¦¬ë¥¼ êµ¬ì›í•´ ì¤„ Yarn Berry](https://toss.tech/article/node-modules-and-yarn-berry)
- [ëª¨ë…¸ë ˆí¬ ì ìš©ë¶€í„° yarn berryê¹Œì§€](https://blog.hwahae.co.kr/all/tech/11962)
- [Symbolic Linked node_modules Structure](https://pnpm.io/next/symlinked-node-modules-structure)
- [ëª¨ë˜ í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸ êµ¬ì„± ê¸°ë²• - ëª¨ë…¸ë ˆí¬ ë„êµ¬ í¸](https://d2.naver.com/helloworld/7553804)
- [TurboRepoì™€ ìºì‹± - ì»¤ìŠ¤í…€ ë¦¬ëª¨íŠ¸ ìºì‹œ ì ìš©í•˜ê¸°](https://programming119.tistory.com/280)
